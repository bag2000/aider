# Bash-Specific AI Rules

Эти правила дополняют Global AI Rules и применяются ко всем Bash-скриптам.

---

## 1. Назначение Bash-скриптов

- Bash используется для:
  - автоматизации задач ОС,
  - обёрток над системными утилитами,
  - простых install / deploy / maintenance сценариев.
- Bash **не используется** для сложной бизнес-логики.

## 2. Совместимость и окружение

- Предполагай:
  - `/usr/bin/env bash`
  - Bash 4+
- Не используй специфичные расширения без необходимости.
- Явно указывай, если скрипт не portable.

## 3. Безопасный режим

- По умолчанию используй:
  ```bash
  set -Eeuo pipefail
- Если отключаешь любой флаг — объясни почему.

## 4. Стиль и структура

- Один скрипт = одна задача.
- Логика читается сверху вниз.
- Используй функции для логических блоков.
- Минимизируй copy-paste.

## 5. Переменные

- Всегда кавычь переменные: `"$var"`.
- Используй `readonly` для констант.
- Имена:
  - `UPPER_CASE` — для констант,
  - `lower_case` — для обычных переменных.
- Не используй однобуквенные имена, кроме локальных счётчиков.

## 6. Пути и файлы

- Не хардкодь пути без причины.
- Проверяй существование файлов и директорий.
- Никогда не делай `rm -rf "$var"` без предварительной проверки значения.

## 7. Условия и проверки

- Используй `[[ ... ]]`, а не `[ ... ]`.
- Проверяй результат команд, а не надейся на успех.
- Предпочитай явные проверки вместо цепочек `&&` / `||`.

## 8. Команды и пайпы

- Проверяй ошибки в пайпах (`pipefail`).
- Не скрывай ошибки редиректами без причины.
- Опасные команды (`rm`, `mv`, `dd`, `mkfs`) — только с защитами.

## 9. Работа с root

- Не предполагается `root` по умолчанию.
- Если нужен `root`:
  - явно проверяй `UID`,
  - или используй `sudo`.
- Предупреждай, если скрипт влияет на систему.

## 10. Внешние зависимости

- Явно перечисляй требуемые утилиты.
- Проверяй их наличие (`command -v`).
- Не полагайся на «оно есть везде».

## 11. Логирование и вывод

- Используй функции для логов: `INFO`, `WARN`, `ERROR`.
- Пиши ошибки в `stderr`.
- Вывод должен помогать понять, что происходит сейчас.

## 12. Аргументы и help

- Поддерживай `-h` / `--help`.
- Объясняй:
  - что делает скрипт,
  - какие параметры принимает,
  - какие есть риски.

## 13. Временные файлы

- Используй `mktemp`.
- Гарантируй очистку через `trap`.

## 14. Комментарии

- Комментарии объясняют **зачем**, а не **что**.
- Особо комментируй:
  - опасные места,
  - нетривиальные проверки.

## 15. Безопасность

- Не выводи секреты в `stdout`.
- Файлы с секретами:
  - минимальные права,
  - проверка владельца.
- Не используй `eval`.

## 16. Цель Bash-скриптов

Bash-скрипты должны быть:
- предсказуемыми,
- безопасными,
- понятными,
- пригодными для сопровождения администратором.